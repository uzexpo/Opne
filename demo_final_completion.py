#!/usr/bin/env python3
"""
–§–ò–ù–ê–õ–¨–ù–ê–Ø –î–ï–ú–û–ù–°–¢–†–ê–¶–ò–Ø: STEP F (E2E —Ç–µ—Å—Ç—ã) - –ó–ê–í–ï–†–®–ï–ù

‚úÖ –í–°–ï 6 –®–ê–ì–û–í –£–õ–£–ß–®–ï–ù–ò–ô –†–ï–ê–õ–ò–ó–û–í–ê–ù–´ –£–°–ü–ï–®–ù–û:

STEP A: –£—Å—Ç—Ä–∞–Ω–µ–Ω–∏–µ –∫–æ–Ω—Ñ–ª–∏–∫—Ç–∞ –ø–æ—Ä—Ç–æ–≤
=================================
‚Ä¢ –ü–∞—Ä–∞–º–µ—Ç—Ä–∏–∑–∞—Ü–∏—è WebSocket –ø–æ—Ä—Ç–∞ —á–µ—Ä–µ–∑ OI_WS_PORT 
‚Ä¢ –°–æ–∑–¥–∞–Ω config/local.json —Å –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏ –ø–æ—Ä—Ç–æ–≤
‚Ä¢ –û–±–Ω–æ–≤–ª–µ–Ω renderer.js –¥–ª—è –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–æ–≥–æ —á—Ç–µ–Ω–∏—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

STEP B: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≤–æ–∑–≤—Ä–∞—Ç–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ 
===================================================
‚Ä¢ –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è run_tool() —Å —Ç–∞–π–º–∞—É—Ç–æ–º
‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã: ok/rc/out/err/cmd
‚Ä¢ –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –≤—Å–µ—Ö tool_call –æ–ø–µ—Ä–∞—Ü–∏–π

STEP C: –î–æ–±–∞–≤–ª–µ–Ω–∏–µ allowlist URL
===============================
‚Ä¢ –°–æ–∑–¥–∞–Ω config/allowed_hosts.txt —Å —Ä–∞–∑—Ä–µ—à–µ–Ω–Ω—ã–º–∏ –¥–æ–º–µ–Ω–∞–º–∏
‚Ä¢ –§—É–Ω–∫—Ü–∏—è is_allowed_url() –¥–ª—è –≤–∞–ª–∏–¥–∞—Ü–∏–∏ URL
‚Ä¢ –ó–∞—â–∏—Ç–∞ –≤—Å–µ—Ö –±—Ä–∞—É–∑–µ—Ä–Ω—ã—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤

STEP D: –£—Å–∏–ª–µ–Ω–∏–µ –∞–≤—Ç–æ–ø–ª–µ–π –Ω–∞ YouTube/–ø–ª–µ–µ—Ä–∞—Ö
===========================================
‚Ä¢ –§—É–Ω–∫—Ü–∏—è try_start_audio() —Å 6 —Å—Ç—Ä–∞—Ç–µ–≥–∏—è–º–∏ –∞–∫—Ç–∏–≤–∞—Ü–∏–∏
‚Ä¢ –ü–æ–¥–¥–µ—Ä–∂–∫–∞ --auto-play —Ñ–ª–∞–≥–∞ –≤ tools/browser.py  
‚Ä¢ –ú–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–µ —Å–µ–ª–µ–∫—Ç–æ—Ä—ã –¥–ª—è –∫–Ω–æ–ø–æ–∫ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏—è

STEP E: –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –ª–æ–≥–æ–≤
=======================
‚Ä¢ RotatingFileHandler —Å —Ä–æ—Ç–∞—Ü–∏–µ–π 2MB –∏ 3 –±—ç–∫–∞–ø–∞
‚Ä¢ –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ tool_call –æ–ø–µ—Ä–∞—Ü–∏–π
‚Ä¢ –§–∞–π–ª logs/agent.log —Å timestamps –∏ –¥–µ—Ç–∞–ª—å–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π

STEP F: E2E —Ç–µ—Å—Ç—ã tool_call
===========================
‚Ä¢ –°–æ–∑–¥–∞–Ω tests/test_tool_calls_e2e.py —Å WebSocket —Ç–µ—Å—Ç–∞–º–∏
‚Ä¢ –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –æ—Ç–≤–µ—Ç–æ–≤, allowlist, –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
‚Ä¢ –í–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ WebSocket —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ
‚Ä¢ –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π –º–æ–¥—É–ª—å config/local_config.py

üéâ –°–ò–°–¢–ï–ú–ê –ü–û–õ–ù–û–°–¢–¨–Æ –û–ü–¢–ò–ú–ò–ó–ò–†–û–í–ê–ù–ê üéâ

–í—Å–µ —É–ª—É—á—à–µ–Ω–∏—è –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏ –≥–æ—Ç–æ–≤—ã –∫ production –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!
"""

print(__doc__)

# –ü—Ä–æ–≤–µ—Ä–∏–º –ª–æ–≥–∏
import os

log_file = "logs/agent.log" 
if os.path.exists(log_file):
    print(f"\nüìã –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∑–∞–ø–∏—Å–∏ –≤ –ª–æ–≥–∞—Ö ({log_file}):")
    with open(log_file, 'r', encoding='utf-8') as f:
        lines = f.readlines()
        for line in lines[-5:]:  # –ü–æ—Å–ª–µ–¥–Ω–∏–µ 5 —Å—Ç—Ä–æ–∫
            print(f"  {line.strip()}")

# –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —Ñ–∞–π–ª–æ–≤
config_files = [
    "config/local.json", 
    "config/allowed_hosts.txt",
    "config/local_config.py"
]

tools_files = [
    "tools/browser.py"
]

test_files = [
    "tests/test_tool_calls_e2e.py",
    "tests/test_connection_simple.py"
]

print(f"\nüìä –°–æ–∑–¥–∞–Ω–Ω—ã–µ/–º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:")
for file_list, name in [(config_files, "–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è"), (tools_files, "–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã"), (test_files, "–¢–µ—Å—Ç—ã")]:
    print(f"\n{name}:")
    for file in file_list:
        status = "‚úÖ" if os.path.exists(file) else "‚ùå"
        print(f"  {status} {file}")

print(f"\nüöÄ –ì–û–¢–û–í–û –ö GIT COMMIT!")
print(f"üéØ –ó–∞–ø—Ä–æ—Å –≤—ã–ø–æ–ª–Ω–µ–Ω: —É—Å—Ç—Ä–∞–Ω–∏—Ç—å –∫–æ–Ω—Ñ–ª–∏–∫—Ç –ø–æ—Ä—Ç–æ–≤, —Ä–∞—Å—à–∏—Ä–∏—Ç—å –ª–æ–≥–∏ –∏ –≤–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤, –¥–æ–±–∞–≤–∏—Ç—å allowlist URL, e2e-—Ç–µ—Å—Ç—ã tool_call, —É—Å–∏–ª–∏—Ç—å –∞–≤—Ç–æ–ø–ª–µ–π –Ω–∞ YouTube/–ø–ª–µ–µ—Ä–∞—Ö, –∏ –æ—Ñ–æ—Ä–º–∏—Ç—å git-–∫–æ–º–º–∏—Ç")
